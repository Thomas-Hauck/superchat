{{ define "main" }}
<div class="success-container">
  <h1>{{ .Title }}</h1>
  <div class="success-message">
    {{ .Content }}
  </div>
  
  <div id="payment-status"></div>
  
  <a href="/" class="btn btn-primary">Retour à l'accueil</a>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const urlParams = new URLSearchParams(window.location.search);
  const paymentIntentClientSecret = urlParams.get('payment_intent_client_secret');
  
  if (paymentIntentClientSecret) {
    const stripe = Stripe('{{ site.Params.stripe.publicKey }}');
    
    stripe.retrievePaymentIntent(paymentIntentClientSecret).then(({paymentIntent}) => {
      const statusDiv = document.getElementById('payment-status');
      
      switch (paymentIntent.status) {
        case 'succeeded':
          statusDiv.innerHTML = '<p class="success">Paiement confirmé !</p>';
          break;
        case 'processing':
          statusDiv.innerHTML = '<p class="warning">Paiement en cours de traitement.</p>';
          break;
        case 'requires_payment_method':
          statusDiv.innerHTML = '<p class="error">Problème avec le paiement.</p>';
          break;
        default:
          statusDiv.innerHTML = '<p class="error">Statut inconnu.</p>';
          break;
      }
    });
  }
});
</script>
{{ end }}